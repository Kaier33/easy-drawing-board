var EasyDrawingBoard=function(){"use strict";function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function e(t,e){var n=e.canvasWidth,i=e.canvasHeight,a=e.arrowSize;t.save(),t.beginPath(),t.moveTo(e.points[0].x*n,e.points[0].y*i);for(var o=function(t,e,n,i){!function(t,e){t.beginPath(),t.moveTo(e[0].x,e[0].y);for(var n=1;n<e.length;n++)t.lineTo(e[n].x,e[n].y);t.closePath(),t.fill()}(t,function(t,e,n){var i=Math.atan2(e.y-t.y,e.x-t.x),a=n/3*2,o={x:e.x-Math.round(n*Math.cos(i+.6)),y:e.y-Math.round(n*Math.sin(i+.6))},r={x:e.x-Math.round(n*Math.cos(i-.6)),y:e.y-Math.round(n*Math.sin(i-.6))},s={x:e.x-Math.round(a*Math.cos(i+.3)),y:e.y-Math.round(a*Math.sin(i+.3))};return[t,{x:e.x-Math.round(a*Math.cos(i-.3)),y:e.y-Math.round(a*Math.sin(i-.3))},r,e,o,s]}(n,e,i))},r=1;r<e.points.length;r++)o(t,{x:e.points[r].x*n,y:e.points[r].y*i},{x:e.points[r-1].x*n,y:e.points[r-1].y*i},a);t.restore()}return function(){function n(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n);var e=t.container,i=t.lineColor,a=void 0===i?"#f00":i,o=t.lineWidth,r=void 0===o?"1":o,s=t.bgImg,c=void 0===s?"":s,l=t.arrowSize,h=void 0===l?15:l,u=t.canvasBgColor,v=void 0===u?"#fff":u;if(!e)throw Error("No container element were found...");this.canvas=this.createCanvasEl(e),this.context=this.canvas.getContext("2d"),this.type="pencil",this.canvasWidth=this.canvas.width,this.canvasHeight=this.canvas.height,this.canvasBgColor=v,this.lineWidth=r,this.lineColor=a,this.arrowSize=h,this.arrowPoints=[],this.isDrawing=!1,this.image=new Image,this.bgImg=c,this.textareaEl=null,this.measureEl=null,this.textMeasure()}var i,a,o;return i=n,(a=[{key:"createCanvasEl",value:function(t){var e=document.createElement("canvas");return e.style.height="".concat(t.clientHeight,"px"),e.style.width="".concat(t.clientWidht,"px"),e.height=t.clientHeight,e.width=t.clientWidth,t.appendChild(e),e}},{key:"init",value:function(){var t,e=this,n=null,i=this.canvas.getBoundingClientRect(),a=i.x,o=i.y;this.clear(),this.drawBackground(),this.canvas.addEventListener("mousedown",(function(i){e.isDrawing=!0,e.image.src=e.canvas.toDataURL("image/png");var r=i.clientX,s=i.clientY,c=t=r-a,l=n=s-o;if("arrow"===e.type&&(e.arrowPoints=[],e.arrowPoints.push({x:t/e.canvasWidth,y:n/e.canvasHeight})),e.context.moveTo(t,n),e.context.lineWidth=e.lineWidth,e.context.strokeStyle=e.lineColor,e.context.fillStyle=e.lineColor,e.context.beginPath(),"text"===e.type){e.type=null;var h=document.createElement("div");h.classList.add("text-component"),h.style.left="".concat(t,"px"),h.style.top="".concat(n,"px"),e.boxDom=h;var u=document.createElement("textarea");e.textareaEl=u,u.style.width="100%",u.style.height="100%",u.style.color=e.lineColor,u.style.fontSize="16px",u.style.lineHeight="20px",u.placeholder="请点击输入",u.setAttribute("autofocus",!0),e.boxDom.appendChild(u),e.container.appendChild(e.boxDom),u.onblur=function(){e.type=null,u.removeAttribute("autofocus"),e.text(e.context,{text:u.value,position:{x:c,y:l}}),e.container.removeChild(h)},u.addEventListener("input",(function(t){e.measureEl.innerHTML=t.target.value+" ",e.textareaEl.style.width=e.measureEl.clientWidth+"px",e.textareaEl.style.height=e.measureEl.clientHeight+"px"}))}})),this.canvas.addEventListener("mousemove",(function(i){if(e.isDrawing){var r=i.clientX,s=i.clientY,c=r-a,l=s-o,h=t,u=n,v=Math.abs(c-t),d=Math.abs(l-n);c<t&&(h=c),l<n&&(u=l);var g={x:c,y:l,originX:t,originY:n,newOriginX:h,newOriginY:u,distanceX:v,distanceY:d},x=e.handleMousemove()[e.type];x&&x(g)}})),this.canvas.addEventListener("mouseup",(function(){return e.endOfDrawing()})),this.canvas.addEventListener("mouseleave",(function(){return e.endOfDrawing()}))}},{key:"reDraw",value:function(){this.context.clearRect(0,0,this.canvasWidth,this.canvasHeight),this.context.drawImage(this.image,0,0),this.context.beginPath()}},{key:"endOfDrawing",value:function(){this.isDrawing&&(this.context.closePath(),this.isDrawing=!1)}},{key:"clear",value:function(){this.context.fillStyle=this.canvasBgColor,this.context.fillRect(0,0,this.canvasWidth,this.canvasHeight),this.drawBackground()}},{key:"drawBackground",value:function(){if(this.bgImg){var t=this,e=new Image;e.setAttribute("crossOrigin","anonymous"),e.src=this.bgImg,e.onload=function(){t.context.drawImage(this,0,0,t.canvasWidth,t.canvasHeight)}}}},{key:"handleMousemove",value:function(){var t=this;return{pencil:function(e){var n=e.x,i=e.y;t.context.lineTo(n,i),t.context.stroke()},straightLine:function(e){var n=e.x,i=e.y,a=e.originX,o=e.originY;t.reDraw(),t.context.moveTo(a,o),t.context.lineTo(n,i),t.context.stroke()},rect:function(e){var n=e.newOriginX,i=e.newOriginY,a=e.distanceX,o=e.distanceY;t.reDraw(),t.context.rect(n,i,a,o),t.context.stroke(),t.context.closePath()},circle:function(e){var n=e.newOriginX,i=e.newOriginY,a=e.distanceX,o=e.distanceY;t.reDraw();var r=Math.sqrt(a*a+o*o);t.context.arc(n+a,i+o,r,0,2*Math.PI),t.context.stroke()},arrow:function(n){var i=n.x,a=n.y;t.reDraw(),t.arrowPoints[1]={x:i/t.canvasWidth,y:a/t.canvasHeight},e(t.context,{points:t.arrowPoints,arrowSize:t.arrowSize,canvasWidth:t.canvasWidth,canvasHeight:t.canvasHeight})},clear:function(){return t.clear()}}}},{key:"exportBase64",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"png";return this.canvas.toDataURL("image/".concat(t))}},{key:"saveImg",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{type:"png",fileName:"canvas_image"},e=document.createElement("a");e.href=this.canvas.toDataURL("image/".concat(t.type)),e.download="".concat(t.fileName,".").concat(t.type),e.click()}},{key:"config",value:function(t,e){this[t]=e,"canvasBgColor"===t&&this.clear()}},{key:"textMeasure",value:function(){var t=document.createElement("pre");t.classList.add("sketch-temp"),t.classList.add("text-pre"),t.style.fontSize="16px",t.style.lineHeight="20px",this.measureEl=t,this.container.appendChild(t)}},{key:"text",value:function(t,e){e.size=e.size||16,e.lineHeight=e.lineHeight||20,e.font=e.font||'"PingFang SC","Microsoft YaHei","微软雅黑"';var n=e.text;t.save(),t.textBaseline="middle",t.font="".concat(e.size,"px/").concat(e.lineHeight,"px ").concat(e.font),t.globalCompositeOperation="source-over",t.fillStyle=e.color||"#f00",n.replace(/<br>/g,"\n").split(/\n/).map((function(n,i){t.fillText(n,e.position.x+2,e.position.y+i*e.lineHeight+e.lineHeight/2+2)})),t.restore()}}])&&t(i.prototype,a),o&&t(i,o),n}()}();

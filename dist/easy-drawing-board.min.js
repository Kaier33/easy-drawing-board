var EasyDrawingBoard=function(){"use strict";function t(t,n){for(var e=0;e<n.length;e++){var a=n[e];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(){function n(t){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n);var e=t.container,a=t.lineColor,i=void 0===a?"#f00":a,o=t.lineWidth,r=void 0===o?"1":o,s=t.bgImg,c=void 0===s?"":s,h=t.arrowSize,v=void 0===h?15:h,l=t.canvasBgColor,u=void 0===l?"#fff":l;if(!e)throw Error("No container element were found...");this.canvas=this.createCanvasEl(e),this.context=this.canvas.getContext("2d"),this.type="pencil",this.canvasWidth=this.canvas.width,this.canvasHeight=this.canvas.height,this.canvasBgColor=u,this.lineWidth=r,this.lineColor=i,this.arrowSize=v,this.arrowPoints=[],this.isDrawing=!1,this.image=new Image,this.bgImg=c}var e,a,i;return e=n,(a=[{key:"createCanvasEl",value:function(t){var n=document.createElement("canvas");return n.style.height="".concat(t.clientHeight,"px"),n.style.width="".concat(t.clientWidht,"px"),n.height=t.clientHeight,n.width=t.clientWidth,t.appendChild(n),n}},{key:"init",value:function(){var t,n=this,e=null,a=this.canvas.getBoundingClientRect(),i=a.x,o=a.y;this.clear(),this.drawBackground(),this.canvas.addEventListener("mousedown",(function(a){n.isDrawing=!0,n.image.src=n.canvas.toDataURL("image/png");var r=a.clientX,s=a.clientY;t=r-i,e=s-o,"arrow"===n.type&&(n.arrowPoints=[],n.arrowPoints.push({x:t/n.canvasWidth,y:e/n.canvasHeight})),n.context.moveTo(t,e),n.context.lineWidth=n.lineWidth,n.context.strokeStyle=n.lineColor,n.context.fillStyle=n.lineColor,n.context.beginPath()})),this.canvas.addEventListener("mousemove",(function(a){if(n.isDrawing){var r=a.clientX,s=a.clientY,c=r-i,h=s-o,v=t,l=e,u=Math.abs(c-t),g=Math.abs(h-e);c<t&&(v=c),h<e&&(l=h);var d={x:c,y:h,originX:t,originY:e,newOriginX:v,newOriginY:l,distanceX:u,distanceY:g},f=n.handleMousemove()[n.type];f&&f(d)}})),this.canvas.addEventListener("mouseup",(function(){return n.endOfDrawing()})),this.canvas.addEventListener("mouseleave",(function(){return n.endOfDrawing()}))}},{key:"reDraw",value:function(){this.context.clearRect(0,0,this.canvasWidth,this.canvasHeight),this.context.drawImage(this.image,0,0),this.context.beginPath()}},{key:"endOfDrawing",value:function(){this.isDrawing&&(this.context.closePath(),this.isDrawing=!1)}},{key:"clear",value:function(){this.context.fillStyle=this.canvasBgColor,this.context.fillRect(0,0,this.canvasWidth,this.canvasHeight),this.drawBackground()}},{key:"drawBackground",value:function(){if(this.bgImg){var t=this,n=new Image;n.setAttribute("crossOrigin","anonymous"),n.src=this.bgImg,n.onload=function(){t.context.drawImage(this,0,0,t.canvasWidth,t.canvasHeight)}}}},{key:"handleMousemove",value:function(){var t=this;return{pencil:function(n){var e=n.x,a=n.y;t.context.lineTo(e,a),t.context.stroke()},straightLine:function(n){var e=n.x,a=n.y,i=n.originX,o=n.originY;t.reDraw(),t.context.moveTo(i,o),t.context.lineTo(e,a),t.context.stroke()},rect:function(n){var e=n.newOriginX,a=n.newOriginY,i=n.distanceX,o=n.distanceY;t.reDraw(),t.context.rect(e,a,i,o),t.context.stroke(),t.context.closePath()},circle:function(n){var e=n.newOriginX,a=n.newOriginY,i=n.distanceX,o=n.distanceY;t.reDraw();var r=Math.sqrt(i*i+o*o);t.context.arc(e+i,a+o,r,0,2*Math.PI),t.context.stroke()},arrow:function(n){var e=n.x,a=n.y;t.reDraw(),t.arrowPoints[1]={x:e/t.canvasWidth,y:a/t.canvasHeight},t.drawArrow(t.context,{points:t.arrowPoints})},clear:function(){return t.clear()}}}},{key:"getArrowPoint",value:function(t,n,e){var a=Math.atan2(n.y-t.y,n.x-t.x),i=(Math.sqrt(Math.pow(n.y-t.y,2)+Math.pow(n.x-t.x,2)),e/3*2),o={x:n.x-Math.round(e*Math.cos(a+.6)),y:n.y-Math.round(e*Math.sin(a+.6))},r={x:n.x-Math.round(e*Math.cos(a-.6)),y:n.y-Math.round(e*Math.sin(a-.6))},s={x:n.x-Math.round(i*Math.cos(a+.3)),y:n.y-Math.round(i*Math.sin(a+.3))};return[t,{x:n.x-Math.round(i*Math.cos(a-.3)),y:n.y-Math.round(i*Math.sin(a-.3))},r,n,o,s]}},{key:"drawArrow",value:function(t,n){var e=this,a=this.canvasWidth,i=this.canvasHeight;t.save(),t.beginPath(),t.moveTo(n.points[0].x*a,n.points[0].y*i);for(var o=function(t,n,a,i){!function(t,n){t.canvas.width,t.canvas.height,t.beginPath(),t.moveTo(n[0].x,n[0].y);for(var e=1;e<n.length;e++)t.lineTo(n[e].x,n[e].y);t.closePath(),t.fill()}(t,e.getArrowPoint(a,n,i))},r=1;r<n.points.length;r++)o(t,{x:n.points[r].x*a,y:n.points[r].y*i},{x:n.points[r-1].x*a,y:n.points[r-1].y*i},15);t.restore()}},{key:"exportBase64",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"png";return this.canvas.toDataURL("image/".concat(t))}},{key:"saveImg",value:function(t){var n=t.type,e=void 0===n?"png":n,a=t.fileName,i=void 0===a?"canvas_image":a,o=document.createElement("a");o.href=this.canvas.toDataURL("image/".concat(e)),o.download="".concat(i,".").concat(e),o.click()}},{key:"config",value:function(t,n){this[t]=n,"canvasBgColor"===t&&this.clear()}}])&&t(e.prototype,a),i&&t(e,i),n}()}();

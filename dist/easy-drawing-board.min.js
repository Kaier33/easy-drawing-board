var EasyDrawingBoard=function(){"use strict";function t(t,n){for(var a=0;a<n.length;a++){var e=n[a];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function n(t,n){var a=n.canvasWidth,e=n.canvasHeight,i=n.arrowSize;t.save(),t.beginPath(),t.moveTo(n.points[0].x*a,n.points[0].y*e);for(var o=function(t,n,a,e){!function(t,n){t.beginPath(),t.moveTo(n[0].x,n[0].y);for(var a=1;a<n.length;a++)t.lineTo(n[a].x,n[a].y);t.closePath(),t.fill()}(t,function(t,n,a){var e=Math.atan2(n.y-t.y,n.x-t.x),i=a/3*2,o={x:n.x-Math.round(a*Math.cos(e+.6)),y:n.y-Math.round(a*Math.sin(e+.6))},r={x:n.x-Math.round(a*Math.cos(e-.6)),y:n.y-Math.round(a*Math.sin(e-.6))},c={x:n.x-Math.round(i*Math.cos(e+.3)),y:n.y-Math.round(i*Math.sin(e+.3))};return[t,{x:n.x-Math.round(i*Math.cos(e-.3)),y:n.y-Math.round(i*Math.sin(e-.3))},r,n,o,c]}(a,n,e))},r=1;r<n.points.length;r++)o(t,{x:n.points[r].x*a,y:n.points[r].y*e},{x:n.points[r-1].x*a,y:n.points[r-1].y*e},i);t.restore()}return function(){function a(t){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,a);var n=t.container,e=t.lineColor,i=void 0===e?"#f00":e,o=t.lineWidth,r=void 0===o?"1":o,c=t.bgImg,s=void 0===c?"":c,h=t.arrowSize,v=void 0===h?15:h,l=t.canvasBgColor,u=void 0===l?"#fff":l;if(!n)throw Error("No container element were found...");this.canvas=this.createCanvasEl(n),this.context=this.canvas.getContext("2d"),this.type="pencil",this.canvasWidth=this.canvas.width,this.canvasHeight=this.canvas.height,this.canvasBgColor=u,this.lineWidth=r,this.lineColor=i,this.arrowSize=v,this.arrowPoints=[],this.isDrawing=!1,this.image=new Image,this.bgImg=s}var e,i,o;return e=a,(i=[{key:"createCanvasEl",value:function(t){var n=document.createElement("canvas");return n.style.height="".concat(t.clientHeight,"px"),n.style.width="".concat(t.clientWidht,"px"),n.height=t.clientHeight,n.width=t.clientWidth,t.appendChild(n),n}},{key:"init",value:function(){var t,n=this,a=null,e=this.canvas.getBoundingClientRect(),i=e.x,o=e.y;this.clear(),this.drawBackground(),this.canvas.addEventListener("mousedown",(function(e){n.isDrawing=!0,n.image.src=n.canvas.toDataURL("image/png");var r=e.clientX,c=e.clientY;t=r-i,a=c-o,"arrow"===n.type&&(n.arrowPoints=[],n.arrowPoints.push({x:t/n.canvasWidth,y:a/n.canvasHeight})),n.context.moveTo(t,a),n.context.lineWidth=n.lineWidth,n.context.strokeStyle=n.lineColor,n.context.fillStyle=n.lineColor,n.context.beginPath()})),this.canvas.addEventListener("mousemove",(function(e){if(n.isDrawing){var r=e.clientX,c=e.clientY,s=r-i,h=c-o,v=t,l=a,u=Math.abs(s-t),g=Math.abs(h-a);s<t&&(v=s),h<a&&(l=h);var d={x:s,y:h,originX:t,originY:a,newOriginX:v,newOriginY:l,distanceX:u,distanceY:g},f=n.handleMousemove()[n.type];f&&f(d)}})),this.canvas.addEventListener("mouseup",(function(){return n.endOfDrawing()})),this.canvas.addEventListener("mouseleave",(function(){return n.endOfDrawing()}))}},{key:"reDraw",value:function(){this.context.clearRect(0,0,this.canvasWidth,this.canvasHeight),this.context.drawImage(this.image,0,0),this.context.beginPath()}},{key:"endOfDrawing",value:function(){this.isDrawing&&(this.context.closePath(),this.isDrawing=!1)}},{key:"clear",value:function(){this.context.fillStyle=this.canvasBgColor,this.context.fillRect(0,0,this.canvasWidth,this.canvasHeight),this.drawBackground()}},{key:"drawBackground",value:function(){if(this.bgImg){var t=this,n=new Image;n.setAttribute("crossOrigin","anonymous"),n.src=this.bgImg,n.onload=function(){t.context.drawImage(this,0,0,t.canvasWidth,t.canvasHeight)}}}},{key:"handleMousemove",value:function(){var t=this;return{pencil:function(n){var a=n.x,e=n.y;t.context.lineTo(a,e),t.context.stroke()},straightLine:function(n){var a=n.x,e=n.y,i=n.originX,o=n.originY;t.reDraw(),t.context.moveTo(i,o),t.context.lineTo(a,e),t.context.stroke()},rect:function(n){var a=n.newOriginX,e=n.newOriginY,i=n.distanceX,o=n.distanceY;t.reDraw(),t.context.rect(a,e,i,o),t.context.stroke(),t.context.closePath()},circle:function(n){var a=n.newOriginX,e=n.newOriginY,i=n.distanceX,o=n.distanceY;t.reDraw();var r=Math.sqrt(i*i+o*o);t.context.arc(a+i,e+o,r,0,2*Math.PI),t.context.stroke()},arrow:function(a){var e=a.x,i=a.y;t.reDraw(),t.arrowPoints[1]={x:e/t.canvasWidth,y:i/t.canvasHeight},n(t.context,{points:t.arrowPoints,arrowSize:t.arrowSize,canvasWidth:t.canvasWidth,canvasHeight:t.canvasHeight})},clear:function(){return t.clear()}}}},{key:"exportBase64",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"png";return this.canvas.toDataURL("image/".concat(t))}},{key:"saveImg",value:function(t){var n=t.type,a=void 0===n?"png":n,e=t.fileName,i=void 0===e?"canvas_image":e,o=document.createElement("a");o.href=this.canvas.toDataURL("image/".concat(a)),o.download="".concat(i,".").concat(a),o.click()}},{key:"config",value:function(t,n){this[t]=n,"canvasBgColor"===t&&this.clear()}}])&&t(e.prototype,i),o&&t(e,o),a}()}();

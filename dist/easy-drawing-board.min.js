var EasyDrawingBoard=function(){"use strict";function t(t,n){for(var e=0;e<n.length;e++){var a=n[e];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function n(t,n){var e=n.canvasWidth,a=n.canvasHeight,i=n.arrowSize;t.save(),t.beginPath(),t.moveTo(n.points[0].x*e,n.points[0].y*a);for(var o=function(t,n,e,a){!function(t,n){t.beginPath(),t.moveTo(n[0].x,n[0].y);for(var e=1;e<n.length;e++)t.lineTo(n[e].x,n[e].y);t.closePath(),t.fill()}(t,function(t,n,e){var a=Math.atan2(n.y-t.y,n.x-t.x),i=e/3*2,o={x:n.x-Math.round(e*Math.cos(a+.6)),y:n.y-Math.round(e*Math.sin(a+.6))},r={x:n.x-Math.round(e*Math.cos(a-.6)),y:n.y-Math.round(e*Math.sin(a-.6))},c={x:n.x-Math.round(i*Math.cos(a+.3)),y:n.y-Math.round(i*Math.sin(a+.3))};return[t,{x:n.x-Math.round(i*Math.cos(a-.3)),y:n.y-Math.round(i*Math.sin(a-.3))},r,n,o,c]}(e,n,a))},r=1;r<n.points.length;r++)o(t,{x:n.points[r].x*e,y:n.points[r].y*a},{x:n.points[r-1].x*e,y:n.points[r-1].y*a},i);t.restore()}return function(){function e(t){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e);var n=t.container,a=t.lineColor,i=void 0===a?"#f00":a,o=t.lineWidth,r=void 0===o?"1":o,c=t.bgImg,s=void 0===c?"":c,h=t.arrowSize,v=void 0===h?15:h,l=t.canvasBgColor,u=void 0===l?"#fff":l;if(!n)throw Error("No container element were found...");this.canvas=this.createCanvasEl(n),this.context=this.canvas.getContext("2d"),this.type="pencil",this.canvasWidth=this.canvas.width,this.canvasHeight=this.canvas.height,this.canvasBgColor=u,this.lineWidth=r,this.lineColor=i,this.arrowSize=v,this.arrowPoints=[],this.isDrawing=!1,this.image=new Image,this.bgImg=s}var a,i,o;return a=e,(i=[{key:"createCanvasEl",value:function(t){var n=document.createElement("canvas");return n.style.height="".concat(t.clientHeight,"px"),n.style.width="".concat(t.clientWidht,"px"),n.height=t.clientHeight,n.width=t.clientWidth,t.appendChild(n),n}},{key:"init",value:function(){var t,n=this,e=null,a=this.canvas.getBoundingClientRect(),i=a.x,o=a.y;this.clear(),this.drawBackground(),this.canvas.addEventListener("mousedown",(function(a){n.isDrawing=!0,n.image.src=n.canvas.toDataURL("image/png");var r=a.clientX,c=a.clientY;t=r-i,e=c-o,"arrow"===n.type&&(n.arrowPoints=[],n.arrowPoints.push({x:t/n.canvasWidth,y:e/n.canvasHeight})),n.context.moveTo(t,e),n.context.lineWidth=n.lineWidth,n.context.strokeStyle=n.lineColor,n.context.fillStyle=n.lineColor,n.context.beginPath()})),this.canvas.addEventListener("mousemove",(function(a){if(n.isDrawing){var r=a.clientX,c=a.clientY,s=r-i,h=c-o,v=t,l=e,u=Math.abs(s-t),g=Math.abs(h-e);s<t&&(v=s),h<e&&(l=h);var d={x:s,y:h,originX:t,originY:e,newOriginX:v,newOriginY:l,distanceX:u,distanceY:g},f=n.handleMousemove()[n.type];f&&f(d)}})),this.canvas.addEventListener("mouseup",(function(){return n.endOfDrawing()})),this.canvas.addEventListener("mouseleave",(function(){return n.endOfDrawing()}))}},{key:"reDraw",value:function(){this.context.clearRect(0,0,this.canvasWidth,this.canvasHeight),this.context.drawImage(this.image,0,0),this.context.beginPath()}},{key:"endOfDrawing",value:function(){this.isDrawing&&(this.context.closePath(),this.isDrawing=!1)}},{key:"clear",value:function(){this.context.fillStyle=this.canvasBgColor,this.context.fillRect(0,0,this.canvasWidth,this.canvasHeight),this.drawBackground()}},{key:"drawBackground",value:function(){if(this.bgImg){var t=this,n=new Image;n.setAttribute("crossOrigin","anonymous"),n.src=this.bgImg,n.onload=function(){t.context.drawImage(this,0,0,t.canvasWidth,t.canvasHeight)}}}},{key:"handleMousemove",value:function(){var t=this;return{pencil:function(n){var e=n.x,a=n.y;t.context.lineTo(e,a),t.context.stroke()},straightLine:function(n){var e=n.x,a=n.y,i=n.originX,o=n.originY;t.reDraw(),t.context.moveTo(i,o),t.context.lineTo(e,a),t.context.stroke()},rect:function(n){var e=n.newOriginX,a=n.newOriginY,i=n.distanceX,o=n.distanceY;t.reDraw(),t.context.rect(e,a,i,o),t.context.stroke(),t.context.closePath()},circle:function(n){var e=n.newOriginX,a=n.newOriginY,i=n.distanceX,o=n.distanceY;t.reDraw();var r=Math.sqrt(i*i+o*o);t.context.arc(e+i,a+o,r,0,2*Math.PI),t.context.stroke()},arrow:function(e){var a=e.x,i=e.y;t.reDraw(),t.arrowPoints[1]={x:a/t.canvasWidth,y:i/t.canvasHeight},n(t.context,{points:t.arrowPoints,arrowSize:t.arrowSize,canvasWidth:t.canvasWidth,canvasHeight:t.canvasHeight})},clear:function(){return t.clear()}}}},{key:"exportBase64",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"png";return this.canvas.toDataURL("image/".concat(t))}},{key:"saveImg",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{type:"png",fileName:"canvas_image"},n=document.createElement("a");n.href=this.canvas.toDataURL("image/".concat(t.type)),n.download="".concat(t.fileName,".").concat(t.type),n.click()}},{key:"config",value:function(t,n){this[t]=n,"canvasBgColor"===t&&this.clear()}}])&&t(a.prototype,i),o&&t(a,o),e}()}();
